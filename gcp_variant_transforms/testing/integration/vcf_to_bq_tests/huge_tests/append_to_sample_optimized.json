[
  {
    "test_name": "test-1000-genomes-append-to-sample-optimized-step-1",
    "table_name": "test_1000_genomes_append_to_sample_optimized",
    "sample_lookup_optimized_output_table" : "{TABLE_NAME}_samples",
    "input_pattern": "gs://genomics-public-data/1000-genomes/vcf/*.vcf",
    "infer_headers": "True",
    "allow_incompatible_records": "True",
    "sharding_config_path": "gcp_variant_transforms/data/sharding_configs/homo_sapiens_default.yaml",
    "runner": "DataflowRunner",
    "worker_machine_type": "n1-standard-32",
    "worker_disk_type": "compute.googleapis.com/projects//zones//diskTypes/pd-ssd",
    "max_num_workers": "200",
    "assertion_configs": [
      {
        "query": ["NUM_OUTPUT_TABLES"],
        "expected_result": {"num_tables": 51}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}__chr19`"],
        "expected_result": {"num_rows": 1632230}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}_samples__chr19`"],
        "expected_result": {"num_rows": 891197580}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}__chr20`"],
        "expected_result": {"num_rows": 1710332}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}_samples__chr20`"],
        "expected_result": {"num_rows": 933841272}
      }
    ]
  },
  {
    "test_name": "test-1000-genomes-append-to-sample-optimized-step-2",
    "table_name": "test_1000_genomes_append_to_sample_optimized",
    "sample_lookup_optimized_output_table" : "{TABLE_NAME}_samples",
    "input_pattern": "gs://gcp-variant-transforms-testfiles/small_tests/valid-4.0_all_chromosomes.vcf",
    "infer_headers": "True",
    "allow_incompatible_records": "True",
    "sharding_config_path": "gcp_variant_transforms/data/sharding_configs/homo_sapiens_default.yaml",
    "runner": "DataflowRunner",
    "worker_machine_type": "n1-standard-32",
    "worker_disk_type": "compute.googleapis.com/projects//zones//diskTypes/pd-ssd",
    "max_num_workers": "200",
    "append": true,
    "assertion_configs": [
      {
        "query": ["NUM_OUTPUT_TABLES"],
        "expected_result": {"num_tables": 51}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}__chr19`"],
        "expected_result": {"num_rows": 1632231}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}_samples__chr19`"],
        "expected_result": {"num_rows": 891197583}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}__chr20`"],
        "expected_result": {"num_rows": 1710336}
      },
      {
        "query": ["SELECT COUNT(0) AS num_rows FROM `{DATASET_ID}.{TABLE_ID}_samples__chr20`"],
        "expected_result": {"num_rows": 933841284}
      }
    ]
  }
]
